"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[5610],{5610:(F,p,n)=>{n.r(p),n.d(p,{RecoveryPage:()=>M});var h=n(467),a=n(4341),u=n(8422),g=n(9381),d=n(2752),v=n(5788),e=n(3953),f=n(3664),R=n(305),P=n(5601);function y(o,c){if(1&o&&e.nrm(0,"app-header",1),2&o){const s=e.XpG();e.Y8G("title",s.title)("loggedIn",s.loggedIn)}}function U(o,c){if(1&o&&(e.j41(0,"ion-item",8)(1,"span")(2,"small"),e.EFF(3,"Los emails son diferentes"),e.k0s()()()),2&o){const s=e.XpG(2);e.Y8G("hidden",s.emailGroupOk)}}function b(o,c){if(1&o&&(e.j41(0,"ion-item"),e.nrm(1,"ion-input",7),e.k0s(),e.DNE(2,U,4,1,"ion-item",8)),2&o){const s=e.XpG();e.R7$(),e.Y8G("readonly",s.wait),e.R7$(),e.vxM(s.emailGroupOk?-1:2)}}function D(o,c){1&o&&(e.j41(0,"ion-button",9),e.EFF(1,"Acceder"),e.k0s(),e.j41(2,"ion-button",10),e.EFF(3,"Registrarse"),e.k0s())}let M=(()=>{var o;class c{constructor(r,t,i,l){this.fb=r,this.authService=t,this.router=i,this.toastController=l,this.authService.refreshCurrentUser().then(m=>this.currentUser=m),this.wait=!1}get title(){return this.currentUser?"Cambiar la contrase\xf1a":"Restablecer la contrase\xf1a"}get loggedIn(){return!!this.currentUser}get email(){return this.credentials.controls.emailGroup.get("email")}get emailGroupOk(){if(this.currentUser)return console.log("emailGroupOk",!!this.currentUser),!0;{const r=this.credentials.controls.emailGroup;return console.log("emailOk:",!(null!=r&&r.hasError("areEqual"))),!(null!=r&&r.hasError("areEqual"))}}ngOnInit(){console.log("OnInit",this.currentUser);const r=this.currentUser?this.fb.group({email:["",[a.k0.required,a.k0.email]]}):this.fb.group({email:new a.MJ("",[a.k0.required,a.k0.email]),emailAgain:new a.MJ("",[a.k0.required,a.k0.email])},{validators:v.g6.areEqual});this.credentials=this.fb.group({emailGroup:r})}obrirCondicions(){const r=this.router.serializeUrl(this.router.createUrlTree(["service-terms"]));window.open(r,"_blank")}presentToast(r,t){var i=this;return(0,h.A)(function*(){const l=yield i.toastController.create({message:t,buttons:[{text:"Entendido",role:"cancel",handler:()=>{console.log("Toast error Cancel clicked")}}],position:r});l.onDidDismiss().then(E=>{console.log("Toast dismissed",E);const{role:C}=E;i.wait=!1;try{"cancel"==C&&(i.currentUser?i.authService.logout().then(()=>i.router.navigate(["login"])).catch(()=>{const _=new Error("Ha fallado la operaci\xf3n. Si todav\xeda se encuentra como usuario activo, por favor, use 'logout' para abandornar la aplicaci\xf3n.");throw _.name=d.Q8.AuthenticationError,_}):i.router.navigate(["login"]))}catch(_){throw(0,d.vd)(_)}}),yield l.present()})()}passwordRecovery(){var r=this;return(0,h.A)(function*(){if(r.wait=!0,!r.credentials.valid||r.currentUser&&r.currentUser.email!=r.email.value){r.wait=!1;const l=new Error("Error inesperado: Puede que no se cumplan las condiciones del formulario, o ha habido un error en el servicio.");throw l.name=d.Q8.FormError,l}r.authService.sendPasswordResetEmail(r.email.value).then(()=>{r.presentToast("middle","Se ha enviado un email con un enlace que permite restablecer la contrase\xf1a.\nRecuerde que debe incorporar al menos una may\xfascula, una min\xfasculas, un d\xedgito y un s\xedmbolo o espacio.")}).catch(l=>{r.wait=!1;const m=new Error((0,d.u1)(l));throw m.name=d.Q8.AuthenticationError,m}).finally(()=>r.wait=!1)})()}}return(o=c).\u0275fac=function(r){return new(r||o)(e.rXU(a.ok),e.rXU(f.u),e.rXU(R.Ix),e.rXU(P.K_))},o.\u0275cmp=e.VBU({type:o,selectors:[["app-recovery"]],standalone:!0,features:[e.aNF],decls:25,vars:7,consts:[[1,"main"],[3,"title","loggedIn"],[3,"ngSubmit","formGroup"],["color","secondary"],["formGroupName","emailGroup"],["type","email","formControlName","email","label","E-Mail","fill","outline","errorText","email no es v\xe1lido","autocomplete","username","appAutofill",""],["fill","clear","type","submit",3,"disabled"],["type","email","formControlName","emailAgain","label","Repetir e-Mail","fill","outline","helperText","Debe introducir de nuevo el email","errorText","email no es v\xe1lido","autocomplete","email","appAutofill","",3,"readonly"],["color","danger",3,"hidden"],["fill","clear","href","login","color","primary"],["fill","clear","href","register","color","primary"]],template:function(r,t){1&r&&(e.j41(0,"main",0),e.DNE(1,y,1,2,"app-header",1),e.j41(2,"form",2),e.bIt("ngSubmit",function(){return t.passwordRecovery()}),e.j41(3,"ion-card",3)(4,"ion-card-header")(5,"ion-card-title")(6,"h2"),e.EFF(7),e.k0s()()(),e.j41(8,"ion-card-content")(9,"ion-list")(10,"ion-item-group",4)(11,"ion-item"),e.nrm(12,"ion-input",5),e.k0s(),e.DNE(13,b,3,2),e.k0s(),e.j41(14,"ion-item")(15,"p")(16,"span"),e.EFF(17,"Este formulario le enviar\xe1 un correo electr\xf3nico con un enlace que le permitir\xe1 establecer de nuevo la contrase\xf1a."),e.k0s(),e.j41(18,"span"),e.EFF(19,"\xa0"),e.j41(20,"small"),e.EFF(21,"Recuerde seguir las normes de esta aplicaci\xf3n para las contrase\xf1as: Puede usar una frase que tenga al menos una may\xfascula y un d\xedgito."),e.k0s()()()()()(),e.j41(22,"ion-button",6),e.EFF(23),e.k0s(),e.DNE(24,D,4,0),e.k0s()()()),2&r&&(e.R7$(),e.vxM(t.currentUser?1:-1),e.R7$(),e.Y8G("formGroup",t.credentials),e.R7$(5),e.JRh(t.currentUser?"Cambiar la contrase\xf1a":"Restablecer la contrase\xf1a"),e.R7$(6),e.vxM(t.currentUser?-1:13),e.R7$(9),e.Y8G("disabled",!t.credentials.valid||t.wait),e.R7$(),e.SpI(" ",t.currentUser?"Cambiar contrase\xf1a":"Restablecer contrase\xf1a"," "),e.R7$(),e.vxM(t.currentUser?-1:24))},dependencies:[a.X1,a.qT,a.BC,a.cb,a.j4,a.JD,a.$R,g.l,u.b_,u.ME,u.tN,u.I9,u.nf,u.uz,u.$w,u.Jm]}),c})()}}]);
"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[9685],{9685:(P,p,h)=>{h.r(p),h.d(p,{ProfilePage:()=>V});var _=h(467),f=h(4341);class o{constructor(){this._dataLength=0,this._bufferLength=0,this._state=new Int32Array(4),this._buffer=new ArrayBuffer(68),this._buffer8=new Uint8Array(this._buffer,0,68),this._buffer32=new Uint32Array(this._buffer,0,17),this.start()}static hashStr(n,a=!1){return this.onePassHasher.start().appendStr(n).end(a)}static hashAsciiStr(n,a=!1){return this.onePassHasher.start().appendAsciiStr(n).end(a)}static _hex(n){const a=o.hexChars,t=o.hexOut;let e,r,i,c;for(c=0;c<4;c+=1)for(r=8*c,e=n[c],i=0;i<8;i+=2)t[r+1+i]=a.charAt(15&e),e>>>=4,t[r+0+i]=a.charAt(15&e),e>>>=4;return t.join("")}static _md5cycle(n,a){let t=n[0],e=n[1],r=n[2],i=n[3];t+=(e&r|~e&i)+a[0]-680876936|0,t=(t<<7|t>>>25)+e|0,i+=(t&e|~t&r)+a[1]-389564586|0,i=(i<<12|i>>>20)+t|0,r+=(i&t|~i&e)+a[2]+606105819|0,r=(r<<17|r>>>15)+i|0,e+=(r&i|~r&t)+a[3]-1044525330|0,e=(e<<22|e>>>10)+r|0,t+=(e&r|~e&i)+a[4]-176418897|0,t=(t<<7|t>>>25)+e|0,i+=(t&e|~t&r)+a[5]+1200080426|0,i=(i<<12|i>>>20)+t|0,r+=(i&t|~i&e)+a[6]-1473231341|0,r=(r<<17|r>>>15)+i|0,e+=(r&i|~r&t)+a[7]-45705983|0,e=(e<<22|e>>>10)+r|0,t+=(e&r|~e&i)+a[8]+1770035416|0,t=(t<<7|t>>>25)+e|0,i+=(t&e|~t&r)+a[9]-1958414417|0,i=(i<<12|i>>>20)+t|0,r+=(i&t|~i&e)+a[10]-42063|0,r=(r<<17|r>>>15)+i|0,e+=(r&i|~r&t)+a[11]-1990404162|0,e=(e<<22|e>>>10)+r|0,t+=(e&r|~e&i)+a[12]+1804603682|0,t=(t<<7|t>>>25)+e|0,i+=(t&e|~t&r)+a[13]-40341101|0,i=(i<<12|i>>>20)+t|0,r+=(i&t|~i&e)+a[14]-1502002290|0,r=(r<<17|r>>>15)+i|0,e+=(r&i|~r&t)+a[15]+1236535329|0,e=(e<<22|e>>>10)+r|0,t+=(e&i|r&~i)+a[1]-165796510|0,t=(t<<5|t>>>27)+e|0,i+=(t&r|e&~r)+a[6]-1069501632|0,i=(i<<9|i>>>23)+t|0,r+=(i&e|t&~e)+a[11]+643717713|0,r=(r<<14|r>>>18)+i|0,e+=(r&t|i&~t)+a[0]-373897302|0,e=(e<<20|e>>>12)+r|0,t+=(e&i|r&~i)+a[5]-701558691|0,t=(t<<5|t>>>27)+e|0,i+=(t&r|e&~r)+a[10]+38016083|0,i=(i<<9|i>>>23)+t|0,r+=(i&e|t&~e)+a[15]-660478335|0,r=(r<<14|r>>>18)+i|0,e+=(r&t|i&~t)+a[4]-405537848|0,e=(e<<20|e>>>12)+r|0,t+=(e&i|r&~i)+a[9]+568446438|0,t=(t<<5|t>>>27)+e|0,i+=(t&r|e&~r)+a[14]-1019803690|0,i=(i<<9|i>>>23)+t|0,r+=(i&e|t&~e)+a[3]-187363961|0,r=(r<<14|r>>>18)+i|0,e+=(r&t|i&~t)+a[8]+1163531501|0,e=(e<<20|e>>>12)+r|0,t+=(e&i|r&~i)+a[13]-1444681467|0,t=(t<<5|t>>>27)+e|0,i+=(t&r|e&~r)+a[2]-51403784|0,i=(i<<9|i>>>23)+t|0,r+=(i&e|t&~e)+a[7]+1735328473|0,r=(r<<14|r>>>18)+i|0,e+=(r&t|i&~t)+a[12]-1926607734|0,e=(e<<20|e>>>12)+r|0,t+=(e^r^i)+a[5]-378558|0,t=(t<<4|t>>>28)+e|0,i+=(t^e^r)+a[8]-2022574463|0,i=(i<<11|i>>>21)+t|0,r+=(i^t^e)+a[11]+1839030562|0,r=(r<<16|r>>>16)+i|0,e+=(r^i^t)+a[14]-35309556|0,e=(e<<23|e>>>9)+r|0,t+=(e^r^i)+a[1]-1530992060|0,t=(t<<4|t>>>28)+e|0,i+=(t^e^r)+a[4]+1272893353|0,i=(i<<11|i>>>21)+t|0,r+=(i^t^e)+a[7]-155497632|0,r=(r<<16|r>>>16)+i|0,e+=(r^i^t)+a[10]-1094730640|0,e=(e<<23|e>>>9)+r|0,t+=(e^r^i)+a[13]+681279174|0,t=(t<<4|t>>>28)+e|0,i+=(t^e^r)+a[0]-358537222|0,i=(i<<11|i>>>21)+t|0,r+=(i^t^e)+a[3]-722521979|0,r=(r<<16|r>>>16)+i|0,e+=(r^i^t)+a[6]+76029189|0,e=(e<<23|e>>>9)+r|0,t+=(e^r^i)+a[9]-640364487|0,t=(t<<4|t>>>28)+e|0,i+=(t^e^r)+a[12]-421815835|0,i=(i<<11|i>>>21)+t|0,r+=(i^t^e)+a[15]+530742520|0,r=(r<<16|r>>>16)+i|0,e+=(r^i^t)+a[2]-995338651|0,e=(e<<23|e>>>9)+r|0,t+=(r^(e|~i))+a[0]-198630844|0,t=(t<<6|t>>>26)+e|0,i+=(e^(t|~r))+a[7]+1126891415|0,i=(i<<10|i>>>22)+t|0,r+=(t^(i|~e))+a[14]-1416354905|0,r=(r<<15|r>>>17)+i|0,e+=(i^(r|~t))+a[5]-57434055|0,e=(e<<21|e>>>11)+r|0,t+=(r^(e|~i))+a[12]+1700485571|0,t=(t<<6|t>>>26)+e|0,i+=(e^(t|~r))+a[3]-1894986606|0,i=(i<<10|i>>>22)+t|0,r+=(t^(i|~e))+a[10]-1051523|0,r=(r<<15|r>>>17)+i|0,e+=(i^(r|~t))+a[1]-2054922799|0,e=(e<<21|e>>>11)+r|0,t+=(r^(e|~i))+a[8]+1873313359|0,t=(t<<6|t>>>26)+e|0,i+=(e^(t|~r))+a[15]-30611744|0,i=(i<<10|i>>>22)+t|0,r+=(t^(i|~e))+a[6]-1560198380|0,r=(r<<15|r>>>17)+i|0,e+=(i^(r|~t))+a[13]+1309151649|0,e=(e<<21|e>>>11)+r|0,t+=(r^(e|~i))+a[4]-145523070|0,t=(t<<6|t>>>26)+e|0,i+=(e^(t|~r))+a[11]-1120210379|0,i=(i<<10|i>>>22)+t|0,r+=(t^(i|~e))+a[2]+718787259|0,r=(r<<15|r>>>17)+i|0,e+=(i^(r|~t))+a[9]-343485551|0,e=(e<<21|e>>>11)+r|0,n[0]=t+n[0]|0,n[1]=e+n[1]|0,n[2]=r+n[2]|0,n[3]=i+n[3]|0}start(){return this._dataLength=0,this._bufferLength=0,this._state.set(o.stateIdentity),this}appendStr(n){const a=this._buffer8,t=this._buffer32;let r,i,e=this._bufferLength;for(i=0;i<n.length;i+=1){if(r=n.charCodeAt(i),r<128)a[e++]=r;else if(r<2048)a[e++]=192+(r>>>6),a[e++]=63&r|128;else if(r<55296||r>56319)a[e++]=224+(r>>>12),a[e++]=r>>>6&63|128,a[e++]=63&r|128;else{if(r=1024*(r-55296)+(n.charCodeAt(++i)-56320)+65536,r>1114111)throw new Error("Unicode standard supports code points up to U+10FFFF");a[e++]=240+(r>>>18),a[e++]=r>>>12&63|128,a[e++]=r>>>6&63|128,a[e++]=63&r|128}e>=64&&(this._dataLength+=64,o._md5cycle(this._state,t),e-=64,t[0]=t[16])}return this._bufferLength=e,this}appendAsciiStr(n){const a=this._buffer8,t=this._buffer32;let r,e=this._bufferLength,i=0;for(;;){for(r=Math.min(n.length-i,64-e);r--;)a[e++]=n.charCodeAt(i++);if(e<64)break;this._dataLength+=64,o._md5cycle(this._state,t),e=0}return this._bufferLength=e,this}appendByteArray(n){const a=this._buffer8,t=this._buffer32;let r,e=this._bufferLength,i=0;for(;;){for(r=Math.min(n.length-i,64-e);r--;)a[e++]=n[i++];if(e<64)break;this._dataLength+=64,o._md5cycle(this._state,t),e=0}return this._bufferLength=e,this}getState(){const n=this._state;return{buffer:String.fromCharCode.apply(null,Array.from(this._buffer8)),buflen:this._bufferLength,length:this._dataLength,state:[n[0],n[1],n[2],n[3]]}}setState(n){const a=n.buffer,t=n.state,e=this._state;let r;for(this._dataLength=n.length,this._bufferLength=n.buflen,e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],r=0;r<a.length;r+=1)this._buffer8[r]=a.charCodeAt(r)}end(n=!1){const a=this._bufferLength,t=this._buffer8,e=this._buffer32,r=1+(a>>2);this._dataLength+=a;const i=8*this._dataLength;if(t[a]=128,t[a+1]=t[a+2]=t[a+3]=0,e.set(o.buffer32Identity.subarray(r),r),a>55&&(o._md5cycle(this._state,e),e.set(o.buffer32Identity)),i<=4294967295)e[14]=i;else{const c=i.toString(16).match(/(.*?)(.{0,8})$/);if(null===c)return;const I=parseInt(c[2],16),S=parseInt(c[1],16)||0;e[14]=I,e[15]=S}return o._md5cycle(this._state,e),n?this._state:o._hex(this._state)}}if(o.stateIdentity=new Int32Array([1732584193,-271733879,-1732584194,271733878]),o.buffer32Identity=new Int32Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),o.hexChars="0123456789abcdef",o.hexOut=[],o.onePassHasher=new o,"5d41402abc4b2a76b9719d911017c592"!==o.hashStr("hello"))throw new Error("Md5 self test failed.");var l=h(6855),b=h(5079),F=h(8397),v=h(9381),m=h(5788),g=h(2752),d=h(2507),s=h(3953),y=h(305),U=h(3664);function L(u,n){1&u&&s.nrm(0,"app-menu",0)}function N(u,n){if(1&u&&(s.j41(0,"ion-card-title",10),s.EFF(1),s.k0s(),s.j41(2,"p",10),s.EFF(3),s.k0s()),2&u){const a=s.XpG();s.R7$(),s.JRh(a.UsuariNoValidat),s.R7$(2),s.SpI("",a.HintUsuariNoValidat," ")}}function w(u,n){if(1&u){const a=s.RV6();s.j41(0,"ion-list")(1,"ion-item")(2,"ion-input",11),s.bIt("input",function(e){s.eBV(a);const r=s.XpG();return s.Njj(r.nomInputEvent(e))}),s.k0s()(),s.j41(3,"ion-item")(4,"ion-input",12),s.bIt("input",function(e){s.eBV(a);const r=s.XpG();return s.Njj(r.imgUrlInputEvent(e))}),s.j41(5,"ion-icon",13),s.bIt("click",function(){s.eBV(a);const e=s.XpG();return s.Njj(e.imgFromGravatar())}),s.k0s(),s.j41(6,"ion-icon",14),s.bIt("click",function(){s.eBV(a);const e=s.XpG();return s.Njj(e.removeImg())}),s.k0s()()(),s.j41(7,"ion-item")(8,"ion-text"),s.EFF(9,"Un icono puede definirse, por ejemplo, en "),s.j41(10,"a",15)(11,"span",16),s.EFF(12,"Gravatar.com"),s.k0s()()()()(),s.j41(13,"ion-buttons",17)(14,"ion-input",18),s.nrm(15,"ion-input-password-toggle",4),s.k0s(),s.j41(16,"ion-button",19),s.EFF(17," Enviar "),s.k0s()()}if(2&u){const a=s.XpG();s.R7$(2),s.Y8G("disabled",!a.userValidated),s.R7$(2),s.Y8G("disabled",!a.userValidated),s.R7$(9),s.Y8G("hidden",!a.readyToSubmit),s.R7$(),s.Y8G("disabled",!a.userValidated),s.R7$(2),s.Y8G("disabled",!a.profileForm.valid||!a.userValidated)}}function R(u,n){1&u&&(s.j41(0,"ion-button",9),s.EFF(1," Reenviar verificaci\xf3n "),s.k0s())}let V=(()=>{var u;class n{constructor(t,e,r){this.router=t,this.authService=e,this.fb=r,this.authService.refreshCurrentUser(),this._email="",this._profileForm=this.createForm(r)}ngOnInit(){(0,b.a)({gravatar:"assets/gravatar.svg"});const t=this.authService.currentUser;if(!t||!t.email){this.router.navigateByUrl("login",{replaceUrl:!0});const e=new Error("Ning\xfan usuario ha iniciado la sesi\xf3n.");throw e.name=g.Q8.FormError,e}this.fillForm(t)}createForm(t){return t.group({newDisplayName:["",[f.k0.required,f.k0.minLength(3),f.k0.maxLength(30)],[m.mS.createValidator(this.authService)]],photoURL:[""],password:["",[f.k0.required,f.k0.minLength(8),f.k0.maxLength(24),f.k0.pattern(this.pattern)]]})}fillForm(t){var e,r;const i=t.emailVerified;this._email=t.email+(i?"":" ?"),console.log(i?"User verified":"User email pending verification"),this._displayName=null!==(e=t.displayName)&&void 0!==e?e:void 0,this._profileImgUrl=null!==(r=t.photoURL)&&void 0!==r?r:null,this._profileForm.controls.newDisplayName.setValue(t.displayName),this._profileForm.controls.photoURL.setValue(t.photoURL)}get pattern(){return m.hc.password}get title(){return"Perfil del usuario"}get previewTitle(){return"Previsualizaci\xf3n"}get showDisplayName(){return"Nombre p\xfablico para mostrar"}get profileForm(){return this._profileForm}get email(){return this._email}get displayName(){return this._displayName}get profileImgUrl(){return this._profileImgUrl}get userValidated(){var t;const e=this.authService.currentUser;return null!==(t=null==e?void 0:e.emailVerified)&&void 0!==t&&t}get currentDisplayNameDefined(){return!(0,d.uJ)(this._displayName)}get userValidatedWithDisplayname(){const t=this.authService.currentUser;return!!t&&t.emailVerified&&!!t.displayName}get readyToSubmit(){const t=this.authService.currentUser;var e;return!!t&&null!==(e=t.emailVerified)&&void 0!==e&&e&&this._profileForm.controls.newDisplayName.valid&&this._profileForm.controls.photoURL.valid&&(this._profileForm.controls.newDisplayName.value!=t.displayName||this._profileForm.controls.photoURL.value!=t.photoURL)}nomInputEvent(t){const e=(0,d.uJ)(t.target.value)?null:t.target.value,r=null===e?null:(0,d.fX)(e);this._displayName=(0,d.uJ)(r)?null:e}imgUrlInputEvent(t){const e=t.target.value;(0,d.uJ)(e)?this._profileImgUrl=null:e.indexOf("@")>0?(this._profileImgUrl=null,this._profileForm.controls.photoURL.setValue(null)):this._profileImgUrl=t.target.value}imgFromGravatar(){const t=this.authService.currentUser;t&&t.emailVerified&&(this._profileImgUrl=(0,d.Sk)("https://www.gravatar.com/avatar/"+o.hashStr(t.email.trim().toLowerCase())+"?d=mp"),this._profileForm.controls.photoURL.setValue(this.profileImgUrl))}removeImg(){this._profileImgUrl=null,this._profileForm.controls.photoURL.setValue(this.profileImgUrl),this._profileForm.controls.photoURL.reset()}get UsuariNoValidat(){return"Usuario no validado."}get HintUsuariNoValidat(){return"Recuerde revisar el email y validarlo, y entonces ser\xe1 reconocido como usuario.Despu\xe9s, refresque la p\xe1gina, y podr\xe1 introducir el nombre p\xfablico."}submit(){var t=this;return(0,_.A)(function*(){const e=t.authService.currentUser;if(!e||!e.emailVerified){const r=new Error("Ning\xfan usuario ha iniciado la sesi\xf3n: - "+t.UsuariNoValidat);throw r.name=g.Q8.AuthenticationError,r}{let r=t._profileForm.value;const i=r.password;delete r.password,yield t.authService.updateUserProfile(i,r),t._profileForm.controls.password.setValue("")}})()}}return(u=n).\u0275fac=function(t){return new(t||u)(s.rXU(y.Ix),s.rXU(U.u),s.rXU(f.ok))},u.\u0275cmp=s.VBU({type:u,selectors:[["app-profile"]],standalone:!0,features:[s.aNF],decls:31,vars:11,consts:[["loggedIn","true","userValidated","userValidated"],["id","main-content",1,"ion-page"],[3,"title"],["size","12","size-sm","6"],["slot","end"],["alt","user profile avatar preview",3,"src"],["href","/change-email","color","primary",3,"disabled"],["href","/change-password","color","primary",3,"disabled"],[3,"ngSubmit","formGroup"],["href","/resend-verification","color","primary"],[1,"errorMessage"],["type","text","id","newDisplayName","required","","autocomplete","nickname","label","display-name","placeholder","Nombre p\xfablico para mostrar","helperText","El display-name permite a otros usuarios identificarle.","errorText","El display-name debe ser \xfanico, y tener como m\xednimo 3 car\xe1cteres.","formControlName","newDisplayName",3,"input","disabled"],["type","url","id","photoURL","autocomplete","url","label","URL de la imagen","placeholder","(sin avatar)","formControlName","photoURL",3,"input","disabled"],["slot","end","name","gravatar",3,"click"],["slot","end","name","trash-outline",3,"click"],["href","https://es.gravatar.com/site/login","target","_blank"],[1,"hintLink"],[3,"hidden"],["type","password","label","Contrase\xf1a","fill","outline","autocomplete","current-password","placeholder","Debe validar la operaci\xf3n con la contrase\xf1a.","errorText","la contrase\xf1a no es v\xe1lida","formControlName","password",3,"disabled"],["id","profile_button","type","submit",3,"disabled"]],template:function(t,e){if(1&t&&(s.DNE(0,L,1,0,"app-menu",0),s.j41(1,"main",1),s.nrm(2,"app-header",2),s.j41(3,"ion-grid")(4,"ion-row")(5,"ion-col",3)(6,"ion-card")(7,"ion-card-header")(8,"ion-card-title"),s.EFF(9),s.k0s(),s.j41(10,"ion-card-subtitle"),s.EFF(11),s.k0s()(),s.j41(12,"ion-card-content")(13,"ion-item")(14,"ion-label"),s.EFF(15),s.k0s(),s.j41(16,"ion-avatar",4),s.nrm(17,"img",5),s.k0s()()(),s.j41(18,"ion-buttons")(19,"ion-button",6),s.EFF(20," Cambiar email "),s.k0s(),s.j41(21,"ion-button",7),s.EFF(22," Cambiar contrase\xf1a "),s.k0s()()()(),s.j41(23,"ion-col",3)(24,"form",8),s.bIt("ngSubmit",function(){return e.submit()}),s.j41(25,"ion-card")(26,"ion-card-header"),s.DNE(27,N,4,2),s.k0s(),s.j41(28,"ion-card-content"),s.DNE(29,w,18,5)(30,R,2,0,"ion-button",9),s.k0s()()()()()()()),2&t){let r,i;s.vxM(e.userValidated?0:-1),s.R7$(2),s.Y8G("title",e.title),s.R7$(7),s.JRh(e.previewTitle),s.R7$(2),s.SpI(" ",e.email," "),s.R7$(4),s.SpI(" ",null!==(r=e.displayName)&&void 0!==r?r:"(*) "+e.showDisplayName," "),s.R7$(2),s.FS9("src",null!==(i=e.profileImgUrl)&&void 0!==i?i:"/assets/person-outline.svg",s.B4B),s.R7$(2),s.Y8G("disabled",e.userValidated&&!e.currentDisplayNameDefined),s.R7$(2),s.Y8G("disabled",e.userValidated&&!e.currentDisplayNameDefined),s.R7$(3),s.Y8G("formGroup",e.profileForm),s.R7$(3),s.vxM(e.userValidated?-1:27),s.R7$(2),s.vxM(e.userValidated?29:30)}},dependencies:[l.he,l.IO,l.iq,F.Z,v.l,f.X1,f.qT,f.BC,f.cb,f.YS,f.j4,f.JD,l.lO,l.hU,l.ln,l.nf,l.uz,l.$w,l.Wv,l.mC,l.QW,l.Jm,l.b_,l.ME,l.tN,l.HW,l.I9]}),n})()}}]);